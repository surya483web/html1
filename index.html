 <script>
    const backendURL = "http://3.209.2.61:5000"; // Your EC2 backend API

    async function download() {
        const link = document.getElementById("instaLink").value;
        const msg = document.getElementById("message");

        if (link.trim() === "") {
            msg.style.color = "red";
            msg.innerHTML = "❌ Please paste a valid Instagram link";
            return;
        }

        msg.style.color = "yellow";
        msg.innerHTML = "⏳ Processing...";

        try {
            const response = await fetch(`${backendURL}/download`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ url: link })   // ⭐ FIXED: backend expects "url"
            });

            const data = await response.json();

            if (response.ok) {
                msg.style.color = "#0f0";
                msg.innerHTML = "✔ Download Data Received!";

                // If API returns media URL
                if (data.media || data.downloadUrl) {
                    const finalURL = data.media || data.downloadUrl;
                    window.open(finalURL, "_blank");
                }
            } else {
                msg.style.color = "red";
                msg.innerHTML = `❌ Error: ${data.error || "Something went wrong"}`;
            }

        } catch (err) {
            msg.style.color = "red";
            msg.innerHTML = "❌ Cannot connect to backend!";
            console.error(err);
        }
    }
</script>
